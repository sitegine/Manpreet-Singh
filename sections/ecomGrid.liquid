{% schema %}
{
  "name": "Ecom Product Grid",
  "settings": [
    {
      "type": "product",
      "id": "product_1",
      "label": "Product 1"
    },
    {
      "type": "product",
      "id": "product_2",
      "label": "Product 2"
    },
    {
      "type": "product",
      "id": "product_3",
      "label": "Product 3"
    },
    {
      "type": "product",
      "id": "product_4",
      "label": "Product 4"
    },
    {
      "type": "product",
      "id": "product_5",
      "label": "Product 5"
    },
    {
      "type": "product",
      "id": "product_6",
      "label": "Product 6"
    }
  ],
  "presets": [
    {
      "name": "Simple Product Grid"
    }
  ]
}
{% endschema %}

<div class="ecomGrid">
  {% for i in (1..6) %}
    {% assign product_key = 'product_' | append: i %}
    {% assign top_key = 'top_offset_' | append: i %}
    {% assign left_key = 'left_offset_' | append: i %}
    {% assign product_handle = section.settings[product_key] %}
    {% assign top = section.settings[top_key] | default: 10 %}
    {% assign left = section.settings[left_key] | default: 10 %}

    {% if product_handle != blank %}
      {% assign product = all_products[product_handle] %}
      <div class="product-card">
        <div class="hotspot-wrapper">
          <img src="{{ product.featured_image | image_url: width: 600 }}" alt="{{ product.title }}">

          <div class="hotspot-dot" onclick="togglePopup({{ forloop.index0 }})" style="top: {{ top }}%; left: {{ left }}%;">
            +
          </div>

       <div class="hotspot-popup styled-popup" id="popup-{{ forloop.index0 }}">
  <div class="popup-inner">
    <button class="popup-close" onclick="closePopup('popup-{{ forloop.index0 }}')">&times;</button>
    <img src="{{ product.featured_image | image_url: width: 150 }}" alt="{{ product.title }}">
    <div class="popup-details">
      <h4>{{ product.title }}</h4>
      <p>{{ product.price | money }}</p>

      <form onsubmit="addToCartAjax(event, this, 'popup-{{ forloop.index0 }}')">
        {% assign color_options = '' %}
        {% for variant in product.variants %}
          {% assign color = variant.option1 %}
          {% unless color_options contains color %}
            {% assign color_options = color_options | append: color | append: ',' %}
          {% endunless %}
        {% endfor %}

        <label>Choose a variant:</label>
        <div class="variant-options">
          {% assign color_list = color_options | split: ',' %}
          {% for color in color_list %}
            {% if color != '' %}
              <label class="variant-pill">
                <input type="radio" name="variant_color" value="{{ color }}" {% if forloop.first %}checked{% endif %}> {{ color }}
              </label>
            {% endif %}
          {% endfor %}
        </div>

        <label>Quantity:</label>
        <input type="number" name="quantity" value="1" min="1">

        <button type="submit" class="btn">Add to Cart</button>
        <div class="cart-msg" style="display:none; margin-top:10px;"></div>
      </form>
    </div>
  </div>
</div>

        </div>
      </div>
    {% endif %}
  {% endfor %}
</div>

